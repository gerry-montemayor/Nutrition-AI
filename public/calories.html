<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./styles.css">
</head>

<body>
  <nav>
    <form class="back-home" action="/home" method="POST">
      <button type="submit">Back Home</button>
    </form>
    <p> NutritionAI </p>
    <p class="subtitle" style="margin-left: 20px"> ~ Calculator</p>
  </nav>

  <div id="calculator-container">

    <p class="calc-description">This is the Calorie Calculator! Please enter a list of food items. Try to be
      as specific as you can when entering your data, for example: two apples, a medium steak, etc.
    </p>


    <form id="input-form" action="">
      <input type="text" name="foods-input" id="foods-input">
      <button type="submit">Submit Food</button>
    </form>
    <ul id="list-output">

    </ul>
    



    <form id="calories-form" action="">
      <label style="display: none" for="message">Enter Foods: </label>
      <input style="display: none"type="text" name="message" id="message">
      <button type="submit">Calculate Calories</button>
    </form>

    <div id="chat-log"></div>


  </div>
</body>

<script>

  var messageToSend = "";

  //the form user types in foods
  const inputForm = document.getElementById("input-form");
  //the input element of the form
  const userInput = document.getElementById("foods-input");

  //the list element that holds all inputs
  const foodListDiv = document.getElementById("list-output")

  const chatLog = document.getElementById("chat-log");
  const message = document.getElementById("message");
  const caloriesForm = document.getElementById("calories-form");



  inputForm.addEventListener('submit', (e) => {
    e.preventDefault();
    var inputFood = userInput.value;
    messageToSend+=` ${inputFood},`;
    userInput.value="";

    const listElement = document.createElement('li');
    listElement.innerHTML = `${inputFood}`
    foodListDiv.appendChild(listElement);
    message.value = messageToSend;
  })




  let messages = []

  caloriesForm.addEventListener('submit', (e) => {
    e.preventDefault();
    messageToSend = "";

    const messageText = message.value;

    const newMessage = {
      "role": "user",
      "content": `${messageText}`
    }
    messages.push(newMessage);

    message.value = "s"
    const messageElement = document.createElement('div');
    messageElement.innerHTML = `<div> ${messageText}</div>`
    chatLog.appendChild(messageElement);

    fetch('/calories', {
      method: 'POST',
      headers: {
        'Content-type': 'application/json'
      },
      body: JSON.stringify({ messages })
    }).then(res => res.json())
      .then(data => {
        let newAssistantMessage = { "role": "assistant", "content": `${data.completion.content}` }
        messages.push(newAssistantMessage);
        const messageText = message.value;
        message.value = "";
        const messageElement = document.createElement('div');
        messageElement.innerHTML = `<div>${data.completion.content}</div>`;
        chatLog.appendChild(messageElement);

      })

  })




</script>

</html>